<!-- 动作库、搜索栏 -->
<view class="body">
	<view class="top">
		<view class="title">动作库</view>
		<!-- 分类下拉菜单 -->
		<view class="select-search">
			<!-- 分类下拉菜单 -->
			<van-dropdown-menu overlay="false">
				<van-dropdown-item popup-style="with=180rpx" value="{{ catevalue }}" options="{{ cateOption }}" bind:change="onCateChange" />
			</van-dropdown-menu>
			<!-- 搜索框 -->
			<van-search value="{{ searchText }}" placeholder="请输入搜索关键词" bind:search="onSearch" />
			<!-- 添加按钮 -->
			<van-icon name="add" color="red" size="50rpx" bind:click="showAdd" />
			<!-- 添加动作弹出层部分 必须放在点击按钮的下方-->
			<van-popup show="{{ showAddPop }}" closeable bind:close="onAddClose" custom-class="addpop" position="bottom">
				<!-- 添加动作弹出层首部按钮界面 -->
				<view class="closeandsave">
					<!-- <van-icon name="cross" /> -->
					<text class="savetext">保存</text>
				</view>
				<!-- 添加动作弹出层中间输入界面 -->
				<van-field icon="https://636f-conquercheck-geges-1301732640.tcb.qcloud.la/icon_train_selected.png?sign=15c041cf5dcc24d503cfd47966f20ba3&t=1590112640" placeholder="请输入动作名称" required clickable="false" />
				<van-collapse value="{{ collactiveNames }}" bind:change="onCollChange" clickable="true">

					<!-- 动作类型 -->
					<van-collapse-item title="动作类型" name="1" right-icon="arrow" value="力量训练">
						<van-cell title="力量训练" value="重量+次数" label="常规" />
						<van-cell title="力量训练" value="重量（减去体重）+次数" label="辅助" />
						<van-cell title="有氧训练" value="时间+距离+卡路里" />
					</van-collapse-item>

					<!-- 训练部位细分 -->
					<van-collapse-item title="训练部位" name="2" right-icon="arrow" value="胸-上胸">
						<van-collapse value="{{ collactiveNames1 }}" bind:change="onCollChange1" clickable="true">
							<van-collapse-item title="胸部" name="1" right-icon="arrow">
								<van-cell title="上胸" />
								<van-cell title="中胸" />
								<van-cell title="下胸" />
							</van-collapse-item>
							<van-collapse-item title="背部" name="2" right-icon="arrow">

							</van-collapse-item>
							<van-collapse-item title="肩部" name="3" right-icon="arrow">

							</van-collapse-item>
							<van-collapse-item title="腿部" name="4" right-icon="arrow">

							</van-collapse-item>
						</van-collapse>
					</van-collapse-item>

					<!-- 训练器材 -->
					<van-collapse-item title="训练器材" name="3" right-icon="arrow" value="杠铃">
						<van-cell title="哑铃" />
						<van-cell title="杠铃" />
						<van-cell title="史密斯机" />
						<van-cell title="绳索" />
						<van-cell title="TRX/&弹力带" />
						<van-cell title="器械" />
						<van-cell title="自重" />
					</van-collapse-item>
				</van-collapse>

			</van-popup>

		</view>
	</view>

	<view class="mid">
		<!-- treeselect动作分类选择 -->
		<van-tree-select items="{{ items }}" main-active-index="{{ mainActiveIndex }}" active-id="{{ activeId }}" bind:click-nav="onClickNav" content-item-class="bg" main-item-class="treenav" height="1192rpx">
			<!-- 中间显示动作部分 根据左侧选中选项卡wx:if="{{mainActiveIndex==?}}"判断-->
			<view slot="content" class="content">
				<!-- 没有搜索动作按分类显示 -->
				<view wx:for="{{items.length}}" wx:if="{{mainActiveIndex== index && !queryActionBySearch}}">
					<!-- 获取动作分类，并根据分类进行查询.创建不同grid -->
					<van-grid gutter="{{ 10 }}" column-num="2" custom-class="bg grid" wx:for="{{actionCate}}">
						<view>{{item}}</view>
						<van-grid-item wx:for="{{actionByAreaCate[item]}}" wx:key="_id" text="{{item.actionName}}" bindtap="showPopup" data-actionname="{{item.actionName}}" content-class="griditem">
							<image class="griditemimage" slot="icon" src="{{item.actionImage}}"></image>
						</van-grid-item>
						<!-- 弹出层部分 必须放在点击按钮的下方-->
						<van-popup show="{{ showText }}" bind:close="onClose" closeable custom-style="height:800rpx;width:80%;" wx:for="{{queryActionByName}}" wx:key="_id">
							<!-- 详情通过弹出层tabs展示 -->
							<view class="tabtitle">{{item.actionName}}</view>
							<!-- 弹出层Tabs -->
							<van-tabs type="card" class="poptabs">
								<!-- 详情tab -->
								<van-tab title="详情">
									<!-- 动作卡片 -->
									<van-card>
										<!-- 图片部分 -->
										<view slot="title">
											<image src="{{item.actionImage}}" class="actionimage"></image>
										</view>
										<!-- 描述部分 -->
										<view slot="desc">
											<!-- 根据动作描述数组逐个渲染 -->
											<view class="subtitle">动作描述：</view>
											<view wx:for="{{item.actionDesc}}" wx:key="index">
												{{index+1}}、{{item}}
											</view>
										</view>
										<!-- 卡片底部标签和展示按钮部分 -->
										<view slot="bottom">
											<view class="subtitle">
												<text>训练部位：</text>
												<van-tag type="primary" size="large">{{item.actionArea}}</van-tag>
											</view>
											<!-- 弹出层训练肌群标签 -->
											<view class="subtitle">
												<text>训练侧重：</text>
												<van-tag type="danger" size="large">{{item.actionSub}}</van-tag>
											</view>
											<!-- 弹出层训练器材标签 -->
											<view class="subtitle">
												<text>训练器材：</text>
												<van-tag type="success" size="large">{{item.actionEquipment}}</van-tag>
											</view>

											<view>
												<view class="subtitle">训练要点：</view>
												<view wx:for="{{item.actionNote}}" wx:key="index">
													{{index+1}}、{{item}}
												</view>
											</view>
										</view>

									</van-card>
								</van-tab>

								<!-- 历史记录 -->
								<van-tab title="历史">
									<van-card num="2" desc="描述信息" title="商品标题" thumb="https://636f-conquercheck-geges-1301732640.tcb.qcloud.la/icon_train_selected.png?sign=15c041cf5dcc24d503cfd47966f20ba3&t=1590112640" />
								</van-tab>

								<!-- 趋势折线图 -->
								<van-tab title="趋势">
									<cover-view class="container">
										<!-- 线性表 -->
										<ec-canvas id="mychart-dom-line" canvas-id="mychart-line" ec="{{ lineec }}">
										</ec-canvas>
									</cover-view>
								</van-tab>

								<van-tab title="备注">
									<!-- 打分 -->
									<view class="star">
										<view>对动作进行打分：</view>
										<van-rate value="{{ starvalue }}" size="{{ 25 }}" allow-half color="#ee0a24" void-color="#eee" void-icon="star" bind:change="onStarChange" />
									</view>

									<!-- 备注框 -->
									<van-cell-group>
										<van-field value="{{ message }}" label="备注" type="textarea" placeholder="请输入备注" autosize border="{{ false }}" />
									</van-cell-group>
								</van-tab>
							</van-tabs>
						</van-popup>
					</van-grid>
				</view>

				<!-- 如果发起搜索则动作不再按分类显示 -->
				<view wx:for="{{items.length}}" wx:if="{{mainActiveIndex == index && queryActionBySearch}}">
					<!-- 获取动作分类，并根据分类进行查询.创建不同grid -->
					<van-grid gutter="{{ 10 }}" column-num="2" custom-class="bg grid">
						<view>搜索结果如下:</view>
						<van-grid-item wx:for="{{queryActionBySearch}}" wx:key="_id" text="{{item.actionName}}" bindtap="showPopup" data-actionname="{{item.actionName}}" content-class="griditem">
							<image class="griditemimage" slot="icon" src="{{item.actionImage}}"></image>
						</van-grid-item>
						<!-- 弹出层部分 必须放在点击按钮的下方-->
						<van-popup show="{{ showText }}" bind:close="onClose" closeable custom-style="height:60%;width:80%;" wx:for="{{queryActionByName}}" wx:key="_id">
							<!-- 详情通过弹出层tabs展示 -->
							<view class="tabtitle">{{item.actionName}}</view>
							<!-- 弹出层Tabs -->
							<van-tabs type="card" class="poptabs">
								<!-- 详情tab -->
								<van-tab title="详情">
									<!-- 动作卡片 -->
									<van-card>
										<!-- 图片部分 -->
										<view slot="title">
											<image src="{{item.actionImage}}" class="actionimage"></image>
										</view>
										<!-- 描述部分 -->
										<view slot="desc">
											<!-- 根据动作描述数组逐个渲染 -->
											<view class="subtitle">动作描述：</view>
											<view wx:for="{{item.actionDesc}}" wx:key="index">
												{{index+1}}、{{item}}
											</view>
										</view>
										<!-- 卡片底部标签和展示按钮部分 -->
										<view slot="bottom">
											<view class="subtitle">
												<text>训练部位：</text>
												<van-tag type="primary" size="large">{{item.actionArea}}</van-tag>
											</view>
											<!-- 弹出层训练肌群标签 -->
											<view class="subtitle">
												<text>训练侧重：</text>
												<van-tag type="danger" size="large">{{item.actionSub}}</van-tag>
											</view>
											<!-- 弹出层训练器材标签 -->
											<view class="subtitle">
												<text>训练器材：</text>
												<van-tag type="success" size="large">{{item.actionEquipment}}</van-tag>
											</view>

											<view>
												<view class="subtitle">训练要点：</view>
												<view wx:for="{{item.actionNote}}" wx:key="index">
													{{index+1}}、{{item}}
												</view>
											</view>
										</view>

									</van-card>
								</van-tab>

								<!-- 历史记录 -->
								<van-tab title="历史">
									<van-card num="2" desc="描述信息" title="商品标题" thumb="https://636f-conquercheck-geges-1301732640.tcb.qcloud.la/icon_train_selected.png?sign=15c041cf5dcc24d503cfd47966f20ba3&t=1590112640" />
								</van-tab>

								<!-- 趋势折线图 -->
								<van-tab title="趋势">
									<cover-view class="container">
										<!-- 线性表 -->
										<ec-canvas id="mychart-dom-line" canvas-id="mychart-line" ec="{{ lineec }}">
										</ec-canvas>
									</cover-view>
								</van-tab>

								<van-tab title="备注">
									<!-- 打分 -->
									<view class="star">
										<view>对动作进行打分：</view>
										<van-rate value="{{ starvalue }}" size="{{ 25 }}" allow-half color="#ee0a24" void-color="#eee" void-icon="star" bind:change="onStarChange" />
									</view>

									<!-- 备注框 -->
									<van-cell-group>
										<van-field value="{{ message }}" label="备注" type="textarea" placeholder="请输入备注" autosize border="{{ false }}" />
									</van-cell-group>
								</van-tab>
							</van-tabs>
						</van-popup>
					</van-grid>
				</view>
			</view>

		</van-tree-select>
	</view>
</view>